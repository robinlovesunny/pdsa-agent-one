# 通义灵码企业版

## 概述

通义灵码企业版提供了全面的智能开发解决方案，涵盖开发者授权管理、企业知识库问答、代码生成管理、存储服务连接切换、防火墙配置及角色权限管理等功能。企业版通过灵活的权限配置和知识库管理，帮助企业优化开发流程，提高代码质量和数据安全性，确保团队成员在安全高效的环境中进行智能开发。

## 授权管理

通义灵码管理员可以在控制台中管理开发者的授权，确保组织成员拥有适当的权限访问和使用通义灵码。具体请参见授权管理。

### 准备工作

- 确保已在组织管理后台中完成组织成员的导入
- 确认当前登录用户为组织拥有者或通义灵码管理员

### 主要操作

- 添加开发者：组织管理员可以从组织成员中添加需要授权的开发者
- 移除开发者：支持批量或单个移除不需要使用通义灵码的开发者

## 企业知识库问答

企业知识库问答功能增强了通义灵码的智能问答能力，使其能够结合企业内部的文档和文件进行回答，确保回答更加贴合企业的业务特点。具体请参见企业知识库问答。

### 主要操作

- 知识库管理：管理员可以新建、编辑、删除知识库，并设置知识库的可见范围
- 上传文档：支持上传多种格式的文档（如PDF、DOCX、TXT等），并开启智能问答的检索增强功能
- 数据处理：系统将对上传的文档进行处理，确保其可用于智能问答

## 企业代码生成管理

基于企业代码库的行间代码生成功能，通过结合上传的代码库进行代码补全，使代码生成更加符合企业的编码规范和业务特点。具体请参见企业代码生成增强。

### 主要操作

- 代码库管理：管理员可以上传代码压缩包，管理知识库，并开启或关闭检索增强功能
- 上传代码压缩包：支持上传常用的二方包源码、工具库等，提升行间代码生成的质量

## 知识库问答增强：知识库构建与管理指南

通义灵码能够结合企业知识库的私域数据，生成贴合企业特点的回答。充分发挥检索增强技术的优势，构建高质量的企业知识数据以及合理的知识库权限管理是必不可少的。本文将为您详细介绍如何构造与管理一个高质量的企业知识库。

### 前提条件

- 适用版本：通义灵码企业标准版、企业专属版
- 适用人员：通义灵码管理员、组织内全局管理员（专属版）

### 场景介绍

通义灵码虽然具备广泛的通用知识，但缺乏企业独有的专业知识和数据。通过引入企业知识库，可以帮助模型更精准地理解私域知识，以便生成更加贴合企业特色的个性化回答。通义灵码能够基于知识库进行自由问答，代码优化与生成，广泛应用于企业规范检查、技术支持等多个场景。

例如：

**智能自由问答场景**：
- 企业技术新人入职问答
- 企业安全合规规范问答
- 产品运维故障排查咨询
- 企业内部平台、API使用问答等

**代码优化与生成场景**：
- 根据企业编码规范，确保代码风格的一致性与规范性
- 根据安全规范文档检查代码漏洞，并提出修复建议等

为了最大程度发挥生成的效果，需要从两个方面进行实践。一方面是构建高质量的知识库，确保知识数据的质量；另一方面是清晰的知识库权限分配，确保知识库的可见范围符合预期。为此知识库管理员需要：

1. 提供 AI 友好的、高质量的知识数据，如文档或代码等，陈旧或不准确的信息不仅无法带来增益，反而可能会误导模型，影响回答的准确性
2. 构建一个结构合理、权限隔离的知识库。这不仅保障了数据的隐私和隔离，还保障了知识库的易管理性和可维护性。权限管理混乱的知识库可能会引发数据安全等问题

## 构建高质量知识库

通义灵码的企业知识库问答功能，目前已支持通过文档上传的形式，将其转化为检索增强的知识数据，本章节将重点介绍文档类知识数据的准备原则和方法。如需了解代码类请参见相关文档。

### 文档格式要求

- 格式：支持PDF、CSV、DOCX、TXT、Markdown格式，优先推荐使用Markdown格式
- 大小：每次最多上传10个文件，单文件大小不超过10MB

### 单个文档规范

单个文档需要从名称、标题、格式、内容方面检查是否符合文档规范。

详细说明与示例如下：

#### 文档类型与命名

- 类型：推荐使用Markdown格式。相较于Word和PDF，我们推荐使用Markdown格式以获得更佳的文档处理效果
- 编码：推荐使用UTF-8编码，以确保字符兼容性最佳

**反例**：
- 《编码规范》、《安全规范1》、《安全规范2》、《SR3》这些命名缺乏具体性，不易区分，且可能造成混淆

**正例**：
- 《Java语言编程规范》：明确指出了编程语言和文档性质
- 《API数据安全管理规范》：指出了文档内容和目的
- 《云账号安全使用管理规范》：清晰地表达了文档的主题和适用范围

#### 文档结构

**层级结构**：
需采用多级标题来组织文档内容，避免将信息堆砌在单一段落。特别是对于专有名词的释义，每个专有名词建议单独成行

**各级标题**：
各层级标题含义清晰用词简洁明了，不同标题之间有明显差异。避免使用含义不明的英文缩写、数字或符号。避免罗列文章关键词，这会对模型造成干扰

**反例**：

《AK安全使用规范》

【目录】
关键词：AK、安全规范、Access Key

一、 定义
Access Key（简称AK），是用于身份验证的一种密钥对，由Access Key ID 和 Access Key Secret 组成。它允许用户通过API调用安全地访问系统服务。本规范旨在明确AK的使用规则，确保系统的安全性与稳定性。Access Key ID是代表用于标识用户的身份。Access Key Secret是代表用于加密签名，保证请求的唯一性和不可抵赖性。

二、 使用原则
确保Access Key Secret的保密性，不得泄露给任何未经授权的第三方。遵循最小权限原则授予API调用权限，仅授予完成任务所必需的权限。定期每90天更换Access Key Secret。记录AK的使用情况，并定期审查使用日志，确保没有异常行为，以及在不需要时及时撤销其权限。

三、 安全实践
为确保访问密钥（AK）的安全，我们实施了以下简化的安全实践：在生产环境中，我们优先使用环境变量存储AK，避免硬编码；通过配置管理系统统一管理AK，防止其在代码中的直接暴露。同时，我们对日志进行过滤，确保AK的Secret信息不会被记录。我们还定期进行权限审查，确保AK仅拥有执行必要操作所需的最低权限。此外，建立了异常检测机制，以便快速识别并响应任何可疑的AK使用活动。这些措施共同保障了AK的安全和合理使用。

四、 API调用示例
● 示例1
Node.js中使用AK/SK进行API调用： 在Node.js中，可以使用axios库来发送API请求，并在请求头中包含AK和SK。例如，使用AK和SK进行签名认证的API请求可能如下所示：
【示例代码块】

● 示例2
Python中使用AK/SK调用API： 在Python中，可以使用requests库来发送带有AK和SK的API请求。以下是一个示例代码，展示了如何构建请求并添加签名：
【示例代码块】

**正例**：

《AK安全使用规范》

/*
去除干扰元素：文章开头的目录、关键词等无需召回的内容可以删除，以减少干扰。
专业名词解释：专业名词及其解释应以条目形式列出，以便于模型更好地查找和理解。
 */

一、 定义
● Access Key（简称AK）：是用于身份验证的一种密钥对，由Access Key ID 和 Access Key Secret 组成，它允许用户通过API调用安全地访问系统服务。
● Access Key ID：用于标识用户的身份。
● Access Key Secret：用于加密签名，保证请求的唯一性和不可抵赖性。

/*
避免使用大段落陈述，建议采用分点陈述的方式，以便模型更容易理解
 */

二、 使用原则
● 保密性：Access Key Secret 必须严格保密，不得泄露给任何未经授权的第三方。
● 最小权限：授予API调用的权限应遵循最小权限原则，仅授予完成任务所必需的权限。
● 定期轮换：定期更换Access Key Secret，推荐每90天更换一次。
● 监控与审计：记录AK的使用情况，并定期审查使用日志，确保没有异常行为。
● 及时撤销：当不再需要使用某个AK时，应及时撤销其权限。

三、 安全实践
● 环境变量：在生产环境中，使用环境变量而非硬编码的方式存储AK。
● 配置管理：使用配置管理系统来管理AK，避免直接在代码中出现。
● 日志过滤：确保日志记录中不会出现Access Key Secret。
● 权限审查：定期检查AK的权限设置，确保符合最小权限原则。
● 异常检测：建立异常检测机制，及时发现并处理可疑活动。

/*
关于API调用示例部分，示例层级的名字不清晰，其中"示例1"和"示例2"，需要修改为某个示例的具体名字
*/

四、API调用示例
● Node.js中使用AK/SK进行API调用示例
 在Node.js中，可以使用axios库来发送API请求，并在请求头中包含AK和SK。例如，使用AK和SK进行签名认证的API请求可能如下所示：
【示例代码块】

● Python中使用AK/SK调用API示例
在Python中，可以使用requests库来发送带有AK和SK的API请求。以下是一个示例代码，展示了如何构建请求并添加签名：
【示例代码块】

## 企业知识库存储服务连接切换

企业版支持对接用户自有存储服务，满足企业对数据安全性和敏感性的要求。管理员可以在通义灵码控制台中切换存储服务连接，配置对象存储和向量数据库。具体请参见企业知识库存储服务连接切换。

### 前提条件

- 网络要求：支持公网访问或配置专有网络访问
- 自有存储服务准备：支持多种存储服务（如阿里云OSS、Amazon S3等）和向量数据库（如Elastic Search）

### 操作流程

1. 配置网络访问：根据存储服务的访问方式配置公网或专网访问
2. 切换存储服务：在通义灵码控制台中进行存储服务连接切换配置，并验证连接

## 防火墙配置

在公司网络环境下，企业可以将通义灵码服务相关的URL配置到防火墙白名单中，并打开特定端口，以确保安全使用通义灵码服务。具体请参见防火墙配置。

### 操作指南

- 配置防火墙白名单：将通义灵码服务的URL添加到防火墙白名单中
- 打开特定端口：根据需要打开相应的端口，确保通义灵码服务的正常访问

## 企业角色权限管理

企业版提供灵活的角色管理功能，支持自定义角色和权限配置，确保每个团队成员拥有合适的操作权限。具体请参见企业角色权限管理。

### 主要操作

- 角色管理：管理员可以查看、创建、编辑和删除自定义角色
- 权限配置：为不同角色分配相应的权限，如知识管理权限等
- 角色授权：为角色添加成员，完成角色授权

## 扩展管理

通义灵码提供了扩展管理，支持自定义指令，满足企业编码场景的扩展诉求。

**重要提醒**：该功能目前仅支持 Visual Studio Code 和 JetBrains IDE 插件，不适用于 Lingma IDE。

通义灵码管理员、组织内全局管理员（专属版）在通义灵码控制台-扩展管理中，进行自定义指令的管理、查看自定义指令的相关信息和数据。自定义指令可见范围内的开发者，在通义灵码 中使用/唤起时，即可看到有权限使用的指令。

**重要提醒**：如需使用企业级自定义指令功能，请确保将通义灵码升级到 V1.4.0 及以上；指令启用或修改后，预计需要 5～10 分钟生效，开发者可在通义灵码 中使用。

### 自定义指令管理

#### 查看自定义指令

通义灵码管理员、组织内全局管理员（专属版）进入通义灵码控制台，单击左侧扩展管理模块，即可看到已创建的自定义指令、通义灵码官方指令信息。
单击指令卡片，即可进入指令详情页面，查看指令的基本信息、可见成员范围、对话配置等信息。同时还可以查看指令的使用数据。

#### 创建自定义指令

扩展管理中，单击新建指令，即进入新建自定义指令页面：

**第一步：基本信息填写**

- 指令名称：指令的显示名称，1～64个字符，中文、英文、数字等均可
- 指令名称（英文）：指令的英文名称，1～64个字符，必须为大小写字母、数字、下划线、空格，此名称为开发者在通义灵码 中问答窗口使用/唤起指令时看到的名称，请确保规范性、可读性
- 指令描述：200个字符以内即可，描述指令的使用场景、作用等
- 指令图标：指令的识别图标，提供了颜色、图标选择，可自由组合
- 指令可见范围：
  - 公开·企业内已授权开发者：选择后，企业内已授权使用通义灵码的开发者均可使用该指令
  - 私有·仅指令的可见成员可用：选择后，可在指令新建完成后，添加可见成员

**第二步：对话配置**

- 提示词：5000个字符以内，可输入系统身份提示、要求提示等，如上图中对于做代码命名的提示词设计示意
- 上下文组装：目前提供了#userInput、#selectedCode的上下文选择，并可进行 Prompt 组装的设计，如上图中对上下文进行组装的示例
- 引入对话历史：开启后，将在触发本指令时，引入当前对话的上下文内容

#### 设置可用范围

指令新建完成后，可在指令详情页中进行可见范围的配置或修改。

- 当为公开·企业内已授权开发者时，单击查看可前往授权管理页面中查看已授权开发者
- 当为私有·仅指令的可见成员可用，单击后将打开可见成员管理抽屉，可进行添加、移除可见成员，注意此处仅允许添加授权管理中已授权的开发者

#### 启用或关闭指令

指令新建完成后，建议进行测试后再开启比较大范围的使用者，具体可参考：

1. 修改指令的可见范围为：私有·仅指令的可见成员可用
2. 添加指令的可见成员，仅添加需要参与测试的开发者即可
3. 打开开启指令的开关
4. 可见范围的开发者在通义灵码测试该指令

当测试完成后，可根据最终需要使用该指令的开发者范围进行可用范围的配置。

当你需要关闭该指令时，单击开关关闭即可，关闭后，开发者在通义灵码中使用/唤起指令时，将不可看到该指令。

#### 修改指令信息和配置

在指令详情中，单击右上角修改按钮，即可修改指令的信息。

#### 删除指令

在指令详情中，单击右上角删除按钮，确认后即可删除指令的信息，删除后不可恢复，请谨慎操作。

### 开发者使用指令

在指令可见范围内的开发者，可在通义灵码的智能问答窗口中，输入 / 唤起即可。

### 场景示例

#### 自定义指令配置

**指令名称**

API 开发文档自动生成

**指令名称（英文）**

generate api docs

**指令描述**

在分布式系统、前后端分离架构（SOA模式）中的需求开发都是面向 API 的，所以在 API 开发完成后还要提供与之配套的 API 使用文档，让服务接入方能快速进行开发与联调，本指令可以帮助开发者快速进行 API 开发文档的生成。

**指令图标**

选择一个即可

**指令可见范围**

根据诉求选择

**提示词**

你是一个 Java 专家，有多年的 Java 开发经验，并且是一个文档编写的专家，请按照指定的 Spring MVC 中 RestController 的代码，以及代码内可以获取的注释和你对接口的理解，生成 API 文档。

请按照如下模板生成对应的 API 文档：

标题：接口名

类型：API 的类型（如 GET or POST or PUT）以及 URl

入参：一个表格，第一列参数，第二列类型，第三列说明

出参：一个表格，第一列参数，第二列类型，第三列说明

错误码：一个表格，第一列错误码，第二列错误码说明

**上下文组装**

请为如下的代码#selectedCode 生成 API 接口文档，输出格式为 markdown。

## 企业过滤器配置

通义灵码企业版的管理员、组织内全局管理员（专属版）可以为企业的开发者配置智能问答、行间生成、知识库上传时的安全过滤策略。

该功能目前仅支持 Visual Studio Code 和 JetBrains IDE 插件，不适用于 Lingma IDE。

适用版本：企业标准版、企业专属版

### 功能入口

使用通义灵码管理员、组织内全局管理员（仅适用于企业专属版）账号登录通义灵码控制台，在左侧导航栏选择策略配置 > 过滤器配置。

根据过滤器应用的场景，在顶部标签页选择智能问答、行间生成或知识库上传（仅适用于企业专属版）。

根据需求开启相应过滤器的开关，然后配置相关参数。各场景支持的过滤器类型如下：

| 场景 | 过滤器类型 | 说明 |
|------|------------|------|
| 智能问答 | 智能问答前置过滤器 | 使用通义灵码的智能问答功能时，用户输入给大模型的内容将通过前置过滤器，大模型输出的内容将通过后置过滤器 |
| 智能问答 | 智能问答后置过滤器 | - |
| 行间生成 | 行间生成前置过滤器 | 使用通义灵码的行间生成功能时，用户输入给大模型的内容将通过前置过滤器，大模型输出的内容将通过后置过滤器 |
| 行间生成 | 行间生成后置过滤器 | - |
| 知识库上传 | 知识库上传前置过滤器 | 上传至通义灵码知识库的文件须先通过该过滤器的审核后，方可上传成功 |

### 智能问答、行间生成的前置过滤器配置

**处理方式**：支持通过正则表达式的方式配置过滤器，且支持 3 种模式。

1. 匹配规则时不处理：匹配到正则后，不做任何处理
2. 匹配规则时拦截：匹配到正则后，直接拦截请求，阻断模型请求
3. 匹配规则时替换内容：匹配到正则后，按照配置替换内容

**消息通知**：支持开启消息通知，通过 webhook 的方式，推送到所需要的消息接收平台。

**执行顺序**：按照配置的排序执行。

**正则数量限制**：最多可添加10条。

**正则表达式标准**：正则配置遵循 ECMAScript 标准，支持i（不区分大小写）、g（全局匹配）、s（DOTALL 模式）等常用标志位。

**正则配置示例**：

| 规则名称 | 正则表达式 | 替换内容 | 原文 | 替换后 |
|----------|------------|----------|------|--------|
| 身份证号 | (?<pre>.*)(\d{15})((\d{2})([0-9Xx]))(?<post>.*) | $<pre>***$<post> | 身份证号：330204197709022312。 | 身份证号：***。 |
| 邮箱 | \w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)* | *** | 我的邮箱是 lin***@aliyunmail.com | 我的邮箱是 *** |
| 密码 | (.*password=)([\w\d]+)(.*) | $1***$3 | {password=1213213} | {password=***} |

### 智能问答、行间生成的后置过滤器配置

**处理方式**：支持通过正则表达式的方式配置过滤器，仅支持一种模式，如下：

1. 匹配规则时不处理：匹配到正则后，不做任何处理

**消息通知**：支持开启消息通知，通过 webhook 的方式，推送到所需要的消息接收平台。

**执行顺序**：按照配置的排序执行。

**正则数量限制**：最多可添加10条。

**正则表达式标准**：正则配置遵循 ECMAScript 标准，支持i（不区分大小写）、g（全局匹配）、s（DOTALL 模式）等常用标志位。

**正则配置示例**：

| 规则名称 | 正则表达式 | 原文 |
|----------|------------|------|
| 身份证号 | (?<pre>.*)(\d{15})((\d{2})([0-9Xx]))(?<post>.*) | 身份证号：330204197709022312。 |
| 邮箱 | \w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)* | 我的邮箱是 lin***@aliyunmail.com |
| 密码 | (.*password=)([\w\d]+)(.*) | {password=1213213} |

## 企业推理服务配置

通义灵码企业版基于阿里云百炼平台提供一站式SFT模型微调服务，支持企业私有化模型快速接入与精准管控，实现业务场景定制化适配。

### 背景信息

在公共云上，许多中大型客户对企业的个性化需求提出了更高的要求，希望通过模型微调SFT（Supervised Fine-Tuning）来实现更贴合自身业务场景的定制化适配。为此，阿里云百炼平台提供了从数据准备、模型微调训练到推理部署的一站式解决方案，全面支持模型的SFT相关能力。通义灵码可以无缝集成阿里云百炼的能力，快速响应并满足客户在模型微调和个性化适配方面的需求，助力企业高效实现定制化目标。

### 前提条件

**服务购买**
- 已开通阿里云百炼平台模型训练服务。若未开通可前往阿里云百炼控制台开通
- 已购买通义灵码企业版（标准版/专属版）。具体请参见企业标准版快速入门、企业专属版快速入门

**获取推理服务 API**
- 通过阿里云百炼平台（或其他支持的模型服务平台）完成 SFT 模型的部署。具体请参见模型部署
- 生成推理服务 API地址，并记录 API URL、模型名称、API Key等关键信息。具体请参见首次调用通义千问API

**说明**：目前仅支持阿里云百炼平台模型。

企业管理员完成自有推理服务 API 配置后，通义灵码系统需确保：当企业授权开发者使用通义灵码相关服务时，系统将自动调用企业内部配置的模型服务。

### 操作步骤

1. 登录灵码控制台，在左侧导航栏选择策略配置 > 推理服务配置
2. 在推理服务配置页面中，针对所需的场景，完成模型服务配置：
   - 启用模型服务配置的开关
   - 填写模型的URL地址、模型名称、API密钥信息
   - 然后单击立即测试
3. 成功提示：模型服务连接成功
4. 失败提示：模型服务连接失败，请确保配置内容准确后重新测试
5. 最后单击保存

在 IDE 中，登录企业版账号，在智能会话窗口的输入框中选择模型服务时，即可看到所配置的模型。

本服务支持连接客户自有的第三方模型，对于这些第三方模型的可用性、合规性及安全性，通义灵码不承担任何责任。请您在使用前仔细评估并查阅相关第三方许可协议，确保您的使用行为合法且符合法规要求。